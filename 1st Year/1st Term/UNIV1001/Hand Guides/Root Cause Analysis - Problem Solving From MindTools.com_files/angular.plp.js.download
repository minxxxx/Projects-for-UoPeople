MindToolsPublicApp.controller("plp",["$scope","$http",function(e,n){var t=function(t){n.get(t).success(function(n){e.latestItems=n,e.outOfPlpItems=r(),$(".plp-counter").text(e.latestItems.length);var t=_(e.latestItems,$("#plp").attr("resource-id"),d());learningPlan.showAddThisArticleToPlan(e.latestItems.length,t),function(e){for(var n=0,t=e.length;n<t;n++)learningPlan.changeButtonToMinus($("button[data-id="+e[n].page+"]"))}(e.latestItems)})};var a={rawCookieString:"",combinedCookieArray:[],unreadPlpItemsArray:[],markedAsCompleteArray:[]};$(".add_or_remove_from_plp").on("click",function(n){n.preventDefault(),m();var a=$(this).attr("title"),r=$(this).attr("data-id"),l=$(this).attr("data-url");$(this).hasClass("add_to_plp")?(d()?"Add to My Personal Learning Plan"==a?(g("add",r),e.latestItems.length<11&&learningPlan.changeButtonToMinus($(this)),learningPlan.showAddConfirmationBox()):"Remove from My Personal Learning Plan"==a?(g("remove",r),learningPlan.changeButtonToPlus($(this)),learningPlan.showRemoveConfirmationBox()):$(this).hasClass("article-plp-button")&&(g("add",r),learningPlan.showAddConfirmationBox()):e.latestItems.length>15?learningPlan.showPlpPlusMaxItemsReached():(learningPlan.makeRequest(learningPlan.url.addByUrl+l),learningPlan.changeButtonToMinus($(this)),learningPlan.showAddConfirmationBox()),t(learningPlan.url.getRecent)):$(this).hasClass("remove_from_plp")&&(d()?g("remove",r):learningPlan.makeRequest(learningPlan.url.removeByUrl+l),learningPlan.changeButtonToPlus($(this)),learningPlan.showRemoveConfirmationBox(),t(learningPlan.url.getRecent))}),$(".mark_complete_plp").on("click",function(e){learningPlan.makeRequest(learningPlan.url.completeByUrl+$(this).attr("data-url")),learningPlan.changeButtonToPlus($(this)),learningPlan.showCompletedeConfirmationBox(),e.preventDefault()}),$("#plp-toggle").on("click",function(e){u(),e.preventDefault()}),$("#std-accordion-toggle").on("click",function(e){c(),e.preventDefault()}),$("#plp-mark-complete").on("click",function(){t(learningPlan.url.completeByUrl+window.location.pathname),l(),s(),learningPlan.showCompletedeConfirmationBox()}),$("#plp_bottom_mark_complete").on("click",function(e){e.preventDefault();var n=angular.element($("#plp")).scope();for(x=0;x<n.latestItems.length;x++)n.latestItems[x].page_url==window.location.pathname&&n.markAsRead(x);d()?g("mark_as_read",$(this).attr("data-id")):learningPlan.makeRequest(learningPlan.url.completeByUrl+window.location.pathname),$(this).hide()}),e.addToPlan=function(){var n=$("section.plp").attr("resource-id");d()&&g("add",n);var a="";a=n.length>0?learningPlan.url.addById+n:learningPlan.url.addByUrl+window.location.pathname,e.latestItems.length>15?learningPlan.showPlpPlusMaxItemsReached():(t(a),o(),i(),p(),learningPlan.showAddConfirmationBox())},e.savePlan=function(){d()&&v()},e.markAsRead=function(n){d()&&g("mark_as_read",e.latestItems[n].plp_id),t(learningPlan.url.completeById+e.latestItems[n].plp_id),learningPlan.showCompletedeConfirmationBox()},e.removeFromPlp=function(n){d()?(g("remove",e.latestItems[n].plp_id),t(learningPlan.url.getRecent)):(t(learningPlan.url.removeById+e.latestItems[n].plp_id),l(),s()),learningPlan.showRemoveConfirmationBox(),learningPlan.changeButtonToPlus($("[data-id="+e.latestItems[n].page+"]"))};var r=function(){return e.latestItems.length<5?e.latestItems.length:5},l=function(){$("section.plp #add-to-plp").show()},o=function(){$("section.plp #add-to-plp").hide()},i=function(){$("#plp-mark-complete").show()},s=function(){$("#plp-mark-complete").hide()},p=function(){$("#plp--snapshot").show(),$(".plp .title a span").removeClass("mt-arrow-down").addClass("mt-arrow-up")},m=function(){$("#plp_bottom_mark_complete").show()},u=function(){$("#plp--snapshot").toggle(),$(".plp .title a span").toggleClass("mt-arrow-down mt-arrow-up")},c=function(){$("#std--accordion").toggle(),$(".std-accordion-holder .title a span").toggleClass("mt-arrow-down mt-arrow-up"),$(".std-accordion-holder .title").toggleClass("is-active")},d=function(){return"/amember/loginmember.php"==$(".header-link-club-login a").attr("href")},g=function(e,n){switch(k("plp_public")||y("plp_public","[]|[]",365),A(),e){case"add":y("plp_public",h(n),365);break;case"mark_as_read":y("plp_public",P(n),365);break;case"remove":y("plp_public",f(n),365)}},h=function(e){return-1===a.unreadPlpItemsArray.indexOf(e)&&0==I()&&a.unreadPlpItemsArray.unshift(e),w()&&v(),C()},f=function(e){var n;return-1!=(n=a.unreadPlpItemsArray.indexOf(e))&&a.unreadPlpItemsArray.splice(n,1),-1!=(n=a.markedAsCompleteArray.indexOf(e))&&a.markedAsCompleteArray.splice(n,1),C()},P=function(e){var n=a.unreadPlpItemsArray.indexOf(e),t=a.unreadPlpItemsArray.splice(n,1);return-1===a.markedAsCompleteArray.indexOf(e)&&a.markedAsCompleteArray.push(t[0]),C()},A=function(){a.rawCookieString=k("plp_public"),a.combinedCookieArray=a.rawCookieString.split("|"),""!=a.combinedCookieArray[0]&&(a.unreadPlpItemsArray=JSON.parse(a.combinedCookieArray[0])),""!=a.combinedCookieArray[1]&&void 0!==a.combinedCookieArray[1]&&(a.markedAsCompleteArray=JSON.parse(a.combinedCookieArray[1]))},k=function(e){for(var n=e+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var r=t[a];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(n))return r.substring(n.length,r.length)}return""},y=function(e,n,t){var a=new Date;a.setTime(a.getTime()+24*t*60*60*1e3);var r="expires="+a.toUTCString();document.cookie=e+"="+n+"; "+r+"; domain=.mindtools.com; path=/"},C=function(){return JSON.stringify(a.unreadPlpItemsArray)+"|"+JSON.stringify(a.markedAsCompleteArray)},w=function(){return 1===a.unreadPlpItemsArray.length||(a.unreadPlpItemsArray.length%3==0||!!I())},v=function(){0===$(".mfp-content").length&&($.magnificPopup.open({type:"ajax",items:{src:"/pages/publicPlusUserSignup/getSignupForm/1"},callbacks:{updateStatus:function(e){}}},0),$(".mfp-content").addClass("plp-signup-popup"))},I=function(){return a.unreadPlpItemsArray.length>11||a.markedAsCompleteArray.length>11},_=function(n,t,a){for(var r=0;r<e.latestItems.length;r++)if(e.latestItems[r].page===t)return!0;return!1};t(learningPlan.url.getRecent)}]);